#!/usr/bin/env Rscript

args <- commandArgs(trailingOnly=TRUE)

#just for speeding testing
if(length(args) == 0) {
	args <- c("0","0","0","0", "0")
	args[1] <- paste("/home/cordaz/Scrivania/provaHMM.txt", collapse=NULL)
	args[2] <- as.character(4)
	args[3] <- paste("0.924470425069,0.728996359813,0.753913936542,0.980068724945,0.772685703443,0.874869244634,0.92498630351,0.800806408888", collapse=NULL)
	args[4] <- paste("0.00138419004903,0.00134745651452,0.00185734590042,0.000186870613022,0.00295810419474,0.00843218746978,0.00105637267479,0.00581674544627", collapse=NULL)
	args[5] <- paste("0,1,0,1,0,1,3,1,3,0,0,1,0,1,1,0,1,1,0,0,3,3,3,1,0,1,3,1,0,1,3,3,0,1,1,3,1,3,1,1,0,1,1,0,1,1,2,0,1,2,1,2,0,3,2,1,0,3,0,0,0,0,1,1,0,2,0,1,0,1,1,2,0,3,1,1,3,1,1,2,3,2,0,1,0,1,1,1,0,3,1,3,1,3,1,3,0,1,1,1,2,1,0,1,2,1,1,0,1,2,1,1,1,1,1,0,1,2,2,1,1,3,2,3,3,0,1,2,1,3,1,1,2,0,3,3,2,0,2,1,1,1,1,0,1,1,2,1,1,2,2,3,3,3,2,0,3,3,0,3,0,0,0,1,1,3,1,2,0,1,1,3,0,0,0,0,1,0,3,1,1,3,2,1,3,2,0,3,1,1,1,3,3,0,0,1,0,0,1,1,2,0,1,1,0,1,0,2,1,1,2,0,1,0,2,3,3,1,1,2,0,3,3,1,2,0,0,2,0,0,2,3,1,2,2,0,0,2,1,1,1,1,1,0,3,1,3,3,0,3,3,0,1,1,1,2,2,3,1,0,3,3,1,3,2,2,0,1,0,1,1,0,2,1,0,2,1,0,1,2,3,1,0,2,0,0,0,1,0,1,0,0,1,3,0,2,1,2,1,3,1,1,0,1,2,3,3,3,3,2,0,0,0,0,1,2,1,1,3,1,1,1,1,0,3,0,1,0,2,2,1,0,1,0,0,1,1,3,1,3,0,1,1,1,1,0,3,0,0,1,1,1,2,1,0,0,2,0,3,3,1,2,2,2,1,0,1,1,1,3,1,2,3,2,2,0,1,3,3,1,0,3,2,0,1,1,1,0,2,1,2,0,1,0,0,1,2,1,2,1,3,1,3,2,3,1,3,2,0,1,3,2,0,1,0,0,0,1,0,0,2,0,3,3,0,0,1,1,2,2,0,1,0,0,2,0,1,1,1,1,2,1,2,1,1,1,2,0,2,1,2,1,0,2,3,0,1,1,2,1,2,1,1,1,1,3,3,3,0,1,3,2,0,3,1,1,0,1,2,3,1,1,3,1,1,2,2,1,3,0,2,0,1,1,1,0,1,0,2,3,1,0,3,3,1,3,3,0,1,2,2,2,1,0,0,1,2,1,2,0,1,0,1,2,1,1,0,2,1,1,3,1,0,0,1,0,1,0,1,0,0,1,3,2,2,1,0,0,0,0,0,1,0,1,2,2,0,3,0,1,0,0,0,1,0,1,1,3,3,0,2,0,0,0,1,0,0,1,2,1,0,1,1,1,1,2,1,1,2,3,2,0,0,2,1,1,2,1,2,0,0,3,0,0,2,2,1,3,2,3,0,0,0,0,2,1,1,2,2,0,3,0,2,1,1,1,1,1,3,1,1,3,2,0,2,1,1,1,3,2,3,1,3,1,1,1,3,1,2,2,3,1,1,0,1,1,1,1,1,2,3,3,3,0,0,1,3,1,2,0,2,1,2,1,1,2,0,1,1,2,1,2,2,2,0,2,2,3,1,2,0,2,3,0,2,2,1,2,2,0,0,0,2,0,3,2,2,2,1,3,0,1,0,3,0,1,1,1,0,1,1,0,1,1,2,2,1,1,2,1,0,2,0,0,1,1,2,0,1,0,2,1,0,0,1,1,1,1,2,1,2,2,3,1,1,1,0,1,1,1,0,2,1,3,0,0,0,1,3,2,2,2,1,1,0,3,3,3,3,2,2,1,1,1,2,2,1,1,1,0,1,0,1,1,1,3,1,3,1,1,1,2,1,1,0,1,0,0,3,2,2,2,2,0,1,1,1,1,0,2,1,1,1,1,1,2,1,2,2,0,2,2,1,1,3,1,1,0,0,0,2,0,1,0,1,3,3,2,2,1,0,1,0,0,1,1,1,3,3,2,0,2,1,2,1,2,1,2,1,1,1,1,1,2,1,1,3,2,2,1,0,1,0,2,1,1,1,0,1,2,3,2,0,1,1,1,1,1,1,1,0,2,1,2,2,0,3,0,3,3,0,1,0,0,2,2,1,1,0,0,0,0,1,2,1,0,1,1,1,0,2,2,1,2,0,1,2,1,0,1,3,3,0,2,1,1,0,1,2,1,1,1,1,0,0,1,3,0,1,1,3,0,3,1,2,1,1,1,1,0,1,3,1,1,1,1,1,1,2,2,1,2,2,1,1,1,1,1,1,1,1,3,1,1,1,1,1,2,1,1,2,2,0,0,1,0,2,1,2,1,2,1,1,0,2,1,0,1,1,1,1,1,2,3,3,3,2,0,2,2,3,0,0,2,2,2,1,3,2,1,1,0,1,1,0,1,2,2,2,2,1,1,1,2,2,1,2,0,0,0,2,2,1,1,1,0,3,2,3,2,3,1,2,2,1,2,0,3,1,1,2,0,0,2,0,1,1,1,2,2,0,1,2,1,2,2,0,1,0,1,1,1,1,2,3,1,0,2,2,3,1,0,2,2,2,1,2,0,3,2,2,3,3,0,0,3,1,1,1,2,1,1,0,1,1,1,1,3,0,1,3,1,3,2,1,0,0,2,2,2,1,1,0,0,2,1,0,3,0,3,0,1,3,1,3,3,0,3,1,2,3,3,0,0,1,0,1,1,0,1,1,1,0,1,0,1,1,1,2,0,2,2,2,3,1,1,3,0,1,2,0,1,1,1,1,1,0,3,3,1,0,1,1,0,1,0,1,3,1,3,0,0,0,0,1,3,1,0,0,2,0,1,1,1,1,1,0,1,1,3,3,2,1,1,0,1,1,0,0,2,1,2,2,3,1,1,2,1,0,1,0,2,1,1,3,1,1,2,0,0,1,0,3,0,1,1,1,1,1,1,0,0,1,3,0,3,2,0,0,0,1,1,1,0,1,1,1,1,1,1,0,1,1,3,2,3,0,0,2,1,1,1,1,0,0,2,1,2,2,1,1,3,1,2,2,1,2,2,2,3,1,0,0,3,0,2,3,3,0,1,3,1,1,1,0,1,1,1,0,1,0,1,1,3,3,1,1,3,1,0,3,3,3,1,1,0,0,3,3,2,0,1,1,1,1,1,2,2,3,3,2,1,3,1,0,0,3,3,3,0,3,0,0,0,0,1,2,2,0,0,2,0,0,1,0,0,1,1,2,0,1,3,0,0,0,0,1,3,1,3,0,1,2,2,3,0,1,1,2,1,2,1,1,0,1,0,0,0,0,1,0,1,3,3,2,1,0,2,3,0,0,1,3,1,0,1,2,0,1,0,3,3,3,0,2,3,1,1,1,2,0,1,2,3,1,3,3,3,0,0,0,2,1,0,3,1,3,0,1,3,3,1,1,1,3,0,3,1,3,0,0,2,1,1,1,2,3,1,1,2,1,3,2,2,3,1,0,2,3,1,1,1,1,1,2,1,0,1,0,2,0,2,1,1,0,1,0,0,1,1,2,1,1,1,1,1,2,0,2,1,0,0,0,1,1,0,0,1,1,2,0,1,2,1,1,2,2,1,0,1,2,1,2,1,2,0,2,3,2,2,0,0,2,0,2,2,3,2,1,1,0,0,1,1,2,2,0,2,0,2,0,1,2,0,1,0,0,0,0,3,0,1,1,3,0,0,2,2,3,0,1,1,1,1,2,0,1,3,0,0,0,3,0,2,3,0,3,2,0,1,0,1,3,1,1,0,3,3,2,2,2,1,1,1,1,1,3,1,2,1,1,0,0,1,1,1,1,2,1,1,3,1,1,1,2,3,1,0,3,0,3,0,2,0,1,3,0,0,0,2,0,3,1,1,0,3,0,3,0,0,0,2,2,3,3,1,1,2,2,1,0,2,0,1,1,0,2,2,0,0,0,2,3,0,0,3,2,0,0,3,1,3,0,1,2,0,2,1,0,0,3,2,3,0,0,3,0,0,1,1,3,1,1,2,0,3,3,2,2,1,0,2,1,2,1,2,3,2,0,0,3,1,1,1,2,1,1,2,2,1,1,1,2,1,0,1,2,1,0,2,0,3,3,1,1,0,2,1,2,1,1,1,1,1,1,2,2,0,0,2,1,2,0,3,1,3,0,0,1,1,0,2,0,1,2,1,1,1,3,3,1,2,1,1,0,2,3,3,3,0,0,1,0,0,1,0,1,1,0,3,1,0,3,1,1,3,0,1,0,2,2,2,3,2,3,3,3,0,3,2,1,3,0,1,2,3,3,3,3,3,3,3,3,3,1,1,0,0,1,1,1,0,0,3,3,3,3,3,3,1,0,0,2,1,0,1,2,3,1,0,0,0,2,3,3,1,3,3,0,0,0,3,2,1,0,0,1,3,2,3,2,1,1,0,2,3,1,1,2,1,1,2,3,0,0,3,3,1,0,3,0,2,1,3,3,0,3,0,1,2,1,1,2,2,0,0,0,3,1,1,0,3,3,0,1,3,3,3,3,3,3,3,0,3,0,0,3,0,3,3,0,0,0,3,0,2,0,0,0,0,0,0,1,0,0,3,1,2,0,0,2,1,1,0,1,1,1,0,2,1,0,0,1,0,1,0,1,3,0,1,3,1,1,1,1,2,3,2,1,1,2,1,1,2,0,3,2,2,1,3,0,0,1,1,1,0,0,3,1,3,1,1,1,1,2,0,1,1,0,0,0,3,1,3,1,2,2,0,1,2,0,1,2,1,2,1,2,0,1,0,0,3,3,0,0,3,1,1,0,0,3,2,2,0,0,2,3,2,3,3,2,1,0,1,3,1,2,1,2,1,1,1,1,1,1,0,1,0,2,3,1,3,1,2,3,0,1,1,1,3,0,0,1,1,1,1,0,1,1,3,0,3,1,1,3,2,0,1,3,0,0,0,2,0,0,1,0,1,0,1,2,3,3,1,1,1,0,1,1,1,3,3,2,1,0,2,0,3,0,1,0,0,1,0,3,3,0,1,0,3,1,2,0,3,3,3,0,0,3,3,3,0,0,0,0,0,0,0,1,3,1,3,3,3,0,1,0,0,2,1,3,0,0,1,0,3,0,1,1,2,3,2,0,3,0,1,0,0,3,3,2,0,0,0,1,2,0,1,0,1,0,2,0,2,2,1,2,1,1,2,2,1,1,2,1,1,0,0,3,0,0,2,1,0,0,3,2,3,1,1,1,1,3,0,1,0,1,2,0,0,3,1,0,1,0,1,2,2,0,0,1,0,1,1,1,2,1,1,2,1,1,2,1,1,1,0,1,2,1,3,0,1,1,1,1,1,1,3,1,2,2,1,1,2,1,2,1,1,0,2,0,0,0,1,0,0,1,2,3,1,1,1,1,1,1,1,0,0,2,3,2,0,0,1,0,3,0,3,2,1,2,2,0,0,0,3,2,3,1,0,2,1,1,0,0,0,2,1,0,0,0,1,0,0,0,0,3,0,1,3,0,0,1,1,3,0,0,1,0,1,3,2,0,2,2,3,0,0,3,2,1,1,2,0,1,1,1,0,1,3,2,0,0,0,1,3,1,0,2,3,1,1,3,0,0,3,1,0,1,1,0,0,1,1,1,0,2,0,3,0,3,1,3,0,1,3,0,0,1,2,0,1,0,0,1,1,0,2,2,0,2,0,1,2,0,3,2,1,0,2,0,0,1,2,0,2,0,0,0,1,0,2,2,3,2,0,3,3,0,0,1,1,0,2,0,0,0,0,0,1,3,0,0,2,1,3,0,0,0,1,3,0,2,1,3,2,0,1,3,1,0,3,0,2,0,1,2,0,1,3,0,0,2,3,1,2,0,1,1,2,1,3,0,1,1,1,3,1,1,1,1,2,3,0,1,1,0,2,1,3,1,0,0,0,1,0,1,3,3,0,0,0,2,2,1,3,2,0,1,1,3,1,1,1,0,2,0,1,0,3,3,3,3,1,0,3,1,1,0,3,0,3,1,1,0,0,3,2,1,3,3,3,1,1,0,3,3,0,2,0,3,0,2,1,1,2,0,2,3,3,1,3,0,1,3,1,0,0,0,0,3,3,3,0,1,2,3,1,1,3,0,0,0,1,3,0,2,3,1,1,1,3,0,0,0,3,0,0,1,1,3,0,0,0,0,0,1,2,3,3,2,0,0,1,3,0,0,0,0,2,2,0,0,3,1,2,2,0,1,1,0,0,2,1,2,3,0,3,1,3,0,1,1,0,1,1,2,2,1,0,1,0,3,1,1,3,3,0,1,3,1,2,0,2,0,0,1,1,0,0,0,1,0,0,0,1,0,0,3,1,0,3,0,3,1,0,2,3,1,1,0,3,0,1,1,1,3,1,3,0,1,2,0,0,0,0,3,3,3,3,0,0,2,1,2,1,1,3,1,1,2,2,1,0,3,3,3,0,3,0,1,3,3,0,0,2,2,0,1,2,3,1,0,0,3,2,1,0,0,2,0,3,1,3,3,0,3,2,3,0,0,0,3,2,3,3,1,3,2,0,0,0,0,1,0,2,0,0,1,3,3,0,2,3,1,2,2,1,0,0,0,0,0,1,3,0,0,3,3,0,3,3,1,1,0,3,0,1,2,0,0,1,1,2,1,1,0,1,3,1,0,0,1,0,3,0,3,1,3,1,2,0,2,0,0,2,0,3,0,0,3,2,2,0,3,2,0,0,0,1,3,1,2,1,1,1,1,0,0,0,0,2,0,1,0,2,0,3,2,1,2,1,0,0,2,0,0,0,3,2,0,1,1,3,1,1,2,1,1,0,0,0,0,0,1,2,1,0,3,0,2,2,1,1,2,0,0,1,2,0,0,1,0,1,0,0,3,1,1,2,0,1,1,2,3,2,0,0,3,1,3,1,1,2,3,0,0,0,0,0,1,1,0,2,2,2,2,0,2,0,1,0,3,0,2,1,1,1,1,0,1,0,0,2,0,1,1,3,3,1,0,0,0,1,1,0,1,0,1,0,2,1,0,1,1,3,1,0,0,2,3,0,3,0,2,3,0,0,0,1,1,1,3,0,0,1,0,2,0,0,0,1,0,2,1,0,0,3,2,1,1,1,0,1,1,1,2,1,1,3,1,3,1,0,1,2,3,3,0,1,1,0,0,2,0,3,3,0,2,1,1,2,1,2,1,2,3,3,1,3,1,1,1,1,2,1,1,1,3,3,2,3,1,0,0,1,1,1,2,1,1,1,2,3,1,2,2,2,3,1,3,0,0,0,3,1,0,0,0,0,2,1,0,0,0,3,0,0,0,3,3,1,0,0,0,2,1,1,1,2,2,0,2,1,1,1,1,3,0,0,2,2,1,0,0,3,3,2,2,3,0,2,1,2,1,0,1,2,0,0,0,0,0,1,0,0,3,0,3,0,0,2,0,0,0,0,1,0,0,3,0,3,1,1,2,3,1,3,0,2,0,3,0,1,0,1,3,1,1,1,1,1,1,1,3,1,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1,1,2,0,1,1,2,1,2,1,2,1,0,1,2,1,1,1,1,1,1,0,0,0,1,1,1,1,1,0,0,1,2,0,2,1,2,0,2,2,1,1,0,3,2,1,2,1,0,0,0,0,0,1,1,3,1,0,0,2,2,2,1,2,0,3,3,1,3,1,1,1,0,1,1,1,1,1,1,1,0,3,1,2,3,0,0,3,3,1,1,2,0,0,1,0,0,3,0,0,1,0,3,3,0,0,3,0,2,2,1,3,1,0,2,0,0,1,0,0,1,0,3,0,2,0,0,0,0,0,0,0,3,3,3,3,3,2,2,1,0,0,0,0,3,1,0,0,3,0,1,0,1,0,0,0,0,1,2,0,1,0,1,0,0,0,0,2,2,1,0,3,0,0,1,0,1,0,0,0,0,0,1,0,2,1,1,2,2,1,0,0,3,3,3,0,1,3,3,3,0,0,0,0,3,3,3,2,0,2,0,3,0,2,3,1,0,0,3,1,2,0,2,3,1,0,1,1,3,0,0,3,3,0,2,3,2,0,3,0,2,0,1,0,2,1,2,3,3,3,0,3,2,0,3,3,1,0,0,1,1,1,3,0,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,0,3,0,3,0,0,0,3,1,2,1,0,1,2,3,3,3,1,0,3,0,0,1,1,1,2,0,0,0,0,0,2,0,0,3,2,3,3,1,0,0,1,0,0,2,0,0,3,0,0,3,0,3,3,2,0,3,0,3,1,3,0,3,0,2,3,1,1,0,3,2,0,3,2,0,0,3,0,3,0,1,3,3,3,0,1,0,3,3,0,0,3,0,3,0,0,1,0,1,0,0,1,2,3,2,2,1,2,3,3,1,0,0,3,2,1,1,2,0,0,3,0,3,3,3,3,3,3,3,3,3,0,3,3,3,3,2,1,0,0,0,3,0,3,3,3,0,3,2,3,3,0,1,2,3,3,0,1,2,2,0,3,0,0,1,2,0,1,2,3,3,2,0,0,2,0,2,3,3,2,2,3,0,3,2,3,3,1,0,3,0,3,0,0,0,3,2,1,0,0,3,0,0,1,3,3,3,0,1,0,1,0,0,1,0,3,1,0,0,0,0,3,0,3,3,1,1,0,0,0,2,0,3,1,3,2,2,2,1,0,0,0,0,2,0,1,3,3,2,3,1,1,0,0,1,2,3,1,3,0,1,3,3,3,3,0,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,1,2,3,3,0,3,0,2,0,3,3,0,0,3,0,1,0,0,2,2,0,0,0,0,2,1,0,0,1,1,1,0,0,0,3,1,3,0,0,0,3,0,1,0,3,1,1,0,2,0,0,0,0,0,0,3,0,3,3,0,0,3,0,0,2,3,0,3,3,3,3,1,3,1,0,2,0,2,0,2,0,0,0,0,1,3,3,3,0,0,1,0,0,1,3,2,0,0,0,0,2,3,0,2,0,0,2,0,1,3,1,0,2,0,1,2,2,3,3,0,0,3,0,3,1,2,3,0,0,2,0,0,0,3,0,0,0,0,3,2,3,0,3,1,0,2,0,0,0,0,2,0,0,0,3,2,2,1,1,1,1,3,1,2,1,0,1,1,0,1,1,2,1,0,3,3,0,2,2,0,1,3,2,1,1,0,1,3,1,1,1,1,1,0,1,1,1,0,1,1,2,1,3,2,1,0,0,1,1,1,3,2,0,0,1,0,1,3,0,1,2,1,1,0,1,1,0,1,2,0,1,0,0,1,1,1,1,1,2,2,1,3,0,2,3,1,1,2,0,0,1,1,3,3,1,2,2,1,0,2,0,1,0,1,2,3,1,2,1,1,1,1,2,3,0,3,2,1,1,1,2,0,2,0,1,1,1,1,1,1,1,1,0,1,0,3,2,0,1,1,2,3,2,3,1,2,1,1,1,0,1,3,1,1,1,3,0,3,0,1,0,3,2,0,3,0,0,1,2,0,1,1,0,2,1,1,2,0,0,1,2,1,2,1,2,1,1,1,1,1,0,1,1,1,2,0,2,3,0,1,1,1,1,0,0,0,0,3,1,0,3,2,1,3,1,0,2,1,1,0,0,2,0,0,0,2,3,0,3,2,0,0,0,1,0,0,1,0,1,0,1,1,2,0,3,0,1,0,3,1,1,1,1,1,1,2,1,1,3,1,1,1,0,3,0,1,1,1,1,2,1,3,2,0,1,2,1,1,1,0,1,3,1,1,0,1,1,1,2,2,1,2,0,0,2,0,3,3,0,3,0,0,2,3,1,2,2,3,1,2,2,1,1,2,0,0,1,1,2,3,2,1,1,2,0,0,3,2,1,1,2,2,2,2,1,2,1,0,1,2,1,0,1,2,0,2,0,1,1,1,1,2,1,0,2,2,2,3,0,0,3,1,0,0,1,1,1,1,1,0,0,0,1,2,0,2,1,3,2,2,1,1,1,2,1,3,1,3,1,1,2,1,1,3,3,1,1,2,0,0,1,1,1,1,3,2,0,2,1,0,0,1,0,0,0,1,1,0,0,1,0,1,0,1,2,2,2,1,3,0,2,1,1,3,2,0,3,0,0,1,1,1,2,1,3,1,2,3,1,1,1,2,0,0,3,3,1,0,0,0,3,1,1,1,2,3,2,1,2,2,0,2,1,1,1,1,2,0,0,0,0,1,3,1,0,0,3,1,2,0,3,0,3,1,0,2,3,2,0,0,0,2,1,3,1,1,0,0,0,0,0,1,1,1,0,2,0,0,1,2,0,1,1,3,1,0,1,0,1,3,3,2,1,2,1,0,1,1,2,1,2,3,3,1,1,1,0,3,2,3,0,0,0,1,0,1,2,1,1,1,3,1,0,2,1,3,0,1,2,1,1,1,1,1,0,0,2,0,1,2,1,3,0,1,3,0,1,1,0,0,1,1,3,2,0,1,0,3,1,0,3,1,3,0,3,0,2,1,1,0,0,3,1,2,3,1,3,2,1,1,1,2,3,3,0,3,2,2,2,1,3,3,2,3,3,3,0,3,3,3,0,1,3,2,2,0,3,0,2,1,2,3,3,0,1,3,1,3,2,3,3,2,0,1,3,3,3,1,2,0,3,1,0,1,2,2,3,2,2,2,1,0,3,1,3,0,0,2,3,3,0,1,0,1,1,1,0,0,0,3,0,3,0,3,0,1,0,3,0,0,2,0,0,2,0,0,3,2,1,2,1,1,1,2,3,0,1,1,1,1,2,2,2,1,3,0,3,2,3,2,1,1,0,0,0,3,1,3,0,1,1,0,1,0,1,1,2,2,2,1,2,2,2,1,1,2,3,1,1,1,0,1,2,1,1,2,3,0,0,3,2,0,2,1,2,0,3,0,1,0,0,3,0,2,0,3,1,1,3,1,1,1,1,2,3,2,1,1,3,0,1,2,1,0,0,3,3,0,0,0,2,0,0,0,0,2,0,1,2,2,1,1,1,2,2,0,1,1,1,2,0,0,1,2,1,1,1,2,0,2,0,2,0,3,3,2,0,1,0,1,3,3,1,0,1,0,2,3,3,1,3,2,1,0,3,3,1,1,3,0,1,0,0,1,0,3,0,3,0,0,2,0,0,1,2,0,3,1,1,0,0,3,2,3,1,1,2,1,2,0,2,0,3,2,0,0,3,0,1,0,0,3,1,1,0,3,3,3,3,1,3,0,1,2,1,3,3,2,2,0,1,2,1,1,2,0,1,1,1,1,3,3,3,1,0,0,1,2,3,0,0,0,1,1,1,0,0,3,3,0,1,0,1,2,3,0,0,1,0,3,2,2,2,1,3,1,0,0,0,0,1,2,0,0,0,1,2,2,1,1,1,1,1,2,2,1,1,1,1,0,1,0,1,1,3,0,0,3,0,1,3,3,2,0,2,2,1,1,3,0,0,2,0,3,0,1,3,0,1,1,3,1,1,1,3,1,3,1,3,0,1,2,2,3,0,1,1,2,1,1,3,0,2,1,1,0,0,0,1,1,1,1,0,1,0,0,1,1,3,1,1,1,2,3,1,2,1,1,1,3,0,0,3,3,2,0,3,3,2,0,2,1,1,3,1,1,3,1,1,2,0,0,3,3,1,2,1,1,3,0,0,1,1,0,3,1,0,1,0,0,3,0,1,0,2,1,1,2,2,1,1,1,1,1,1,1,1,2,3,0,1,1,1,3,0,1,2,1,1,1,1,0,1,1,1,1,3,3,0,0,1,0,0,0,2,0,0,0,0,3,1,0,2,2,1,0,0,1,0,3,0,0,0,0,2,0,0,0,1,1,3,0,1,2,0,2,2,1,1,2,1,2,1,1,1,0,0,1,1,3,3,0,1,2,2,1,3,1,1,1,3,1,0,0,1,0,2,0,0,1,3,0,2,2,1,0,3,3,3,1,1,1,1,2,1,0,0,2,0,1,0,3,0,2,1,2,2,1,3,1,3,2,1,1,1,1,3,3,1,0,0,1,0,3,3,3,3,1,3,0,1,1,0,1,0,0,3,1,0,2,1,0,2,3,0,1,1,0,1,2,1,1,1,3,1,3,1,2,0,1,0,0,2,2,1,2,1,1,1,1,2,1,0,1,1,1,1,1,0,3,1,3,3,0,2,1,2,1,1,3,1,1,3,1,0,2,1,2,2,3,0,3,0,0,0,1,1,1,3,1,0,3,1,2,1,2,2,1,2,1,1,1,0,1,1,2,1,0,2,0,1,0,0,0,1,1,0,1,3,1,1,0,1,0,1,2,1,1,1,2,1,1,1,2,0,2,1,2,1,0,1,3,2,1,2,1,0,0,1,0,1,0,1,0,0,1,2,3,0,1,0,0,3,3,0,0,0,0,2,0,2,1,3,0,0,0,3,0,0,2,0,1,1,0,3,2,3,3,1,1,3,2,1,2,1,1,3,1,1,3,0,0,1,3,2,1,1,1,0,1,1,0,3,0,0,2,2,3,2,1,0,0,0,3,2,1,1,1,1,2,0,1,1,0,1,1,1,1,1,1,1,1,1,0,2,1,1,1,1,3,2,1,2,2,1,1,1,0,3,1,1,1,1,1,1,1,0,2,0,1,2,1,2,3,2,1,3,3,1,1,1,1,0,1,2,0,2,1,0,2,2,1,1,3,2,0,2,1,1,1,1,1,3,0,0,0,0,0,3,3,3,1,3,1,1,1,0,3,2,2,0,3,1,1,1,1,0,1,1,3,3,1,3,2,2,1,2,0,3,2,1,1,0,3,1,1,2,1,1,0,0,0,1,0,0,3,2,1,0,0,1,1,3,0,2,1,3,1,1,1,2,3,1,1,0,0,1,2,1,0,1,2,1,1,3,0,0,2,3,1,1,1,1,3,1,3,1,1,3,0,1,1,3,3,0,0,1,1,1,0,0,3,0,0,1,0,1,1,0,1,3,0,3,3,2,1,0,2,1,1,0,1,2,0,1,1,2,3,2,1,1,2,2,1,1,1,1,1,0,1,3,1,3,1,1,1,0,1,2,2,1,1,1,0,0,1,2,1,2,1,0,1,1,0,0,0,1,3,3,1,0,2,1,3,1,1,0,0,1,3,0,1,0,2,3,2,2,1,0,1,1,0,1,2,1,1,2,1,1,1,1,1,3,1,2,3,2,2,2,3,2,2,1,0,0,3,0,2,0,3,1,0,3,0,1,1,3,3,0,2,1,1,2,0,3,0,1,2,2,2,1,0,1,1,2,1,2,3,1,1,1,0,1,2,0,0,1,1,1,0,1,3,1,1,2,2,1,1,0,1,2,3,3,0,1,0,3,2,2,2,2,3,2,3,0,1,0,1,0,0,1,1,1,1,0,1,1,0,0,1,2,1,1,1,3,0,3,0,1,1,3,0,2,0,3,1,1,2,1,2,3,0,1,0,0,3,0,3,0,0,0,3,3,0,0,0,3,1,0,0,0,0,0,2,2,2,2,3,1,1,1,1,1,1,2,1,1,2,1,1,1,2,1,0,3,1,1,2,1,1,1,1,1,1,0,1,2,1,3,1,1,2,3,1,1,2,0,1,1,3,0,1,1,1,2,2,3,2,2,3,1,1,2,2,3,3,2,1,1,1,2,0,3,1,1,2,2,1,1,2,0,2,1,3,0,1,1,1,1,1,0,1,0,2,1,1,1,1,1,3,1,3,0,2,1,2,1,1,2,3,3,3,3,1,1,0,0,1,3,0,2,3,3,3,0,0,3,3,3,3,2,3,3,2,2,2,2,2,1,2,0,3,3,3,3,2,2,2,2,2,2,0,0,1,3,3,3,2,2,2,2,2,2,2,2,2,1,2,2,2,0,3,3,3,3,3,3,1,2,2,1,3,2,2,1,0,0,1,2,1,2,0,2,2,0,3,2,0,2,0,0,2,1,3,1,2,0,1,0,3,1,1,0,3,1,0,2,0,3,0,3,3,3,0,0,1,2,3,3,0,0,1,1,2,1,3,0,1,2,3,0,3,0,0,3,2,3,0,1,3,3,1,3,0,1,3,0,3,0,0,0,1,3,3,0,1,1,2,1,3,0,2,1,1,1,2,1,1,1,1,1,3,3,2,0,2,0,1,2,2,3,1,3,2,0,1,1,0,1,2,1,0,2,1,2,1,1,2,0,3,0,3,1,1,3,1,0,3,0,1,0,1,1,1,0,1,1,1,2,2,0,1,0,0,1,1,3,0,0,0,3,1,1,1,0,2,1,2,2,0,1,2,0,2,1,1,2,2,1,2,2,1,0,1,1,1,1,0,2,1,2,1,3,2,1,1,0,1,3,0,2,1,3,3,1,3,3,1,0,3,1,0,2,1,2,2,0,0,1,2,3,0,0,1,2,1,1,1,2,1,1,1,2,3,1,0,0,1,1,1,2,1,2,0,1,2,3,1,2,0,1,1,1,0,2,0,2,1,1,2,0,3,1,0,2,0,3,1,1,1,1,1,0,0,2,1,2,1,1,2,1,2,1,1,2,0,3,2,1,2,2,2,1,1,3,1,3,2,1,1,1,1,2,2,3,1,1,1,0,2,1,1,2,2,2,1,1,3,2,1,1,3,0,1,2,2,3,1,1,1,1,1,1,3,2,3,1,0,0,2,2,1,0,1,2,1,3,0,0,1,2,2,1,1,1,0,1,1,1,0,2,1,1,1,2,3,1,1,1,2,0,0,0,2,0,1,1,1,3,0,0,0,1,0,2,2,0,2,0,2,2,0,1,2,3,2,0,0,0,0,0,2,0,1,3,1,1,0,1,1,1,2,1,3,1,1,2,2,3,0,1,3,0,0,1,1,0,0,1,1,0,0,1,3,2,0,1,1,1,1,0,2,0,1,1,2,0,1,1,0,1,1,2,2,1,2,0,0,1,3,1,3,3,1,1,3,3,2,3,0,0,3,0,1,1,0,1,1,1,1,2,0,0,2,1,3,0,1,2,1,1,3,2,3,0,1,1,2,1,2,2,2,1,2,0,2,0,0,1,0,0,2,1,1,2,1,0,1,1,1,1,1,0,0,0,1,0,0,0,3,3,3,3,1,0,3,1,0,3,0,3,0,1,0,0,3,0,3,0,3,0,1,0,0,0,2,3,1,2,3,1,0,3,1,1,1,2,1,1,0,1,0,0,0,1,3,0,1,0,0,3,1,0,1,0,3,0,0,0,2,1,2,1,1,2,0,3,1,1,2,1,1,2,3,2,3,1,0,0,0,1,1,2,3,3,0,1,2,1,1,0,3,0,0,1,0,1,0,2,0,0,0,0,2,0,1,1,1,1,0,3,0,1,2,2,1,1,1,1,0,1,1,0,1,1,2,0,2,1,1,1,2,2,2,0,3,2,2,1,3,3,1,1,3,2,2,2,1,0,2,1,1,2,0,2,2,1,3,1,0,1,0,0,0,1,2,2,2,1,2,1,0,2,0,0,1,1,3,1,2,1,1,1,0,0,2,2,3,1,0,0,2,1,1,1,0,1,3,2,2,1,3,1,1,2,0,2,2,1,1,0,0,3,1,0,0,0,1,1,1,1,3,3,3,2,3,1,2,1,1,1,0,1,2,1,1,1,2,0,0,3,1,1,1,1,1,3,1,0,1,1,1,1,3,0,1,2,0,2,3,1,2,1,0,1,0,2,0,0,0,0,1,2,1,0,0,1,3,0,2,1,0,0,1,0,0,1,0,0,3,2,1,0,0,1,0,1,3,1,2,3,2,0,3,1,1,1,1,0,0,3,1,0,1,1,1,1,1,0,1,2,1,1,2,3,1,1,1,0,1,2,0,1,1,0,2,0,1,0,3,2,3,0,0,1,1,2,1,0,1,2,1,1,1,1,3,3,3,2,1,1,0,0,3,2,3,1,0,1,2,2,1,1,0,2,1,3,1,2,0,0,1,0,1,1,1,2,1,0,1,3,1,2,1,3,3,1,1,1,2,3,2,2,0,3,0,3,1,1,2,1,1,1,1,1,1,0,1,0,0,3,2,3,2,0,0,2,1,0,0,1,3,2,1,1,2,1,1,0,1,2,1,1,1,2,2,1,1,0,2,2,0,3,0,1,1,1,3,2,1,1,2,1,1,1,2,1,0,1,0,3,1,0,0,1,2,3,1,2,1,3,0,1,1,1,2,1,1,1,2,3,1,2,1,3,2,1,1,1,1,1,1,1,3,1,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,0,1,1,0,1,1,3,1,3,0,2,2,2,0,0,3,3,3,2,1,2,0,2,2,0,3,2,2,0,0,1,0,1,2,0,1,1,1,1,1,0,1,3,2,3,2,1,3,0,2,3,3,0,3,1,0,0,0,3,2,1,0,3,1,0,1,3,0,3,3,1,1,1,0,1,2,3,3,0,1,0,1,1,2,1,1,1,2,1,0,0,3,0,2,1,1,3,2,2,1,1,1,3,3,1,1,2,0,1,0,0,0,3,1,1,0,0,0,0,1,0,2,1,0,0,1,1,0,0,0,1,2,0,0,2,2,0,3,0,3,3,1,1,1,0,3,1,1,2,2,2,1,2,1,2,3,2,1,1,2,2,0,0,2,2,1,1,2,1,1,3,1,2,0,2,0,1,2,0,1,1,0,3,1,1,2,1,0,0,0,0,1,1,1,3,1,0,2,2,3,0,0,1,0,2,3,2,3,1,1,1,0,0,3,0,1,0,3,1,0,3,0,3,1,1,3,1,1,0,3,0,0,3,3,3,2,1,0,2,0,0,0,0,2,1,2,3,0,3,3,3,0,0,2,0,1,0,0,3,1,2,0,0,0,3,1,1,2,1,1,2,0,1,0,0,1,0,0,0,1,0,1,3,3,1,1,0,0,3,3,1,2,3,0,1,3,1,1,1,2,1,0,1,2,0,2,3,0,0,0,0,3,1,0,1,3,3,3,1,0,1,0,1,3,3,0,2,0,3,0,0,3,2,0,0,1,0,0,0,0,0,0,1,0,0,0,0,3,0,0,3,0,0,0,0,0,0,0,3,0,3,2,0,0,1,1,1,1,2,2,2,3,3,0,1,0,1,3,3,0,0,0,0,1,0,3,2,2,1,1,0,0,2,0,3,0,1,1,0,1,0,2,0,1,3,0,1,0,1,3,1,1,3,0,0,2,3,0,2,1,0,0,0,0,3,1,3,1,1,1,1,3,0,1,1,0,0,0,0,0,2,3,1,0,1,2,0,0,1", collapse=NULL)
}

nstates <- as.numeric(args[2])
file = paste(args[1], collapse=NULL)
mu_list = strsplit(paste(args[3], collapse=NULL), ",")
# print(mu_list)
mu_array = c()
for(i in 1:length(mu_list)) {
	mu_array <- c(mu_array, as.numeric(mu_list[[i]]))
}
# print(mu_array)
sigma_list = strsplit(paste(args[4], collapse=NULL), ",")
sigma_array = c()
for(i in 1:length(sigma_list)) {
	sigma_array <- c(sigma_array, as.numeric(sigma_list[[i]]))
}

assigned_state <- strsplit(paste(args[5], collapse=NULL), ",")
state_array <- c()
for(i in 1:length(assigned_state)) {
	state_array <- c(state_array, as.numeric(assigned_state[[i]]))
}
# print(state_array)
mu <- matrix(mu_array, nrow=nstates, byrow=T)
# print(mu)
sigma <- matrix(sigma_array, nrow=nstates, byrow=T)
sigma <- sqrt(sigma)
# print(sigma)

t <- read.table(file, sep='\t', header=T)
t$X <- NULL
STATE <- cbind(STATE=state_array)
t$STATE <- STATE
# head(t)

counts <- c(length(t$SCORE[t$STATE == 0]))
for (i in 1:(nstates-1)) {
	counts <- c(counts, length(t$SCORE[t$STATE == i]))
}
print(counts)

mean.SCORE <- mean(t$SCORE)
mean.SCORE.1 <- mean(t$SCORE.1)
sd.SCORE <- sd(t$SCORE)
sd.SCORE.1 <- sd(t$SCORE.1)

t$SCORE.zscore <- (t$SCORE - mean.SCORE) / sd.SCORE
t$SCORE.1.zscore <- (t$SCORE.1 - mean.SCORE.1) / sd.SCORE.1


mu.SCORE.zscore <- (mu[,1] - mean.SCORE) / (sd.SCORE / sqrt(counts))
print(mu.SCORE.zscore)
mu.SCORE.1.zscore <- (mu[,2] - mean.SCORE.1) / (sd.SCORE.1 / sqrt(counts))
print(mu.SCORE.1.zscore)
mu.zscore <- matrix(c(mu.SCORE.zscore, mu.SCORE.1.zscore), byrow=F, nrow=nstates)
max.zscore <- max(0, max(mu.SCORE.zscore, mu.SCORE.1.zscore))
min.zscore <- min(0, min(mu.SCORE.zscore, mu.SCORE.1.zscore))

# print(mu.zscore)


kd.1 <- density(t$SCORE)
kd.2 <- density(t$SCORE.1)
kd.1.zscore <- density(t$SCORE.zscore)
kd.2.zscore <- density(t$SCORE.1.zscore)

png(paste(as.character(nstates), "_emissions.png", collapse=NULL, sep=""), width=4*600, height=7*600, res=600, pointsize=10)
par(mfrow=c(nstates+1,1), mar=c(2,2,1,1))

dev.base <- dev.cur()
# print(dev.base)

png(paste(as.character(nstates), "_emissions_score.png", collapse=NULL, sep=""), width=4*600, height=7*600, res=600, pointsize=10)
par(mfrow=c(nstates+1,1), mar=c(2,2,1,1))

dev.zscore <- dev.cur()
# print(dev.zscore)
# Original distributions

dev.set(dev.base)

library(RColorBrewer)


plot(kd.1$x, kd.1$y * sd.SCORE, col='#ef8a62', type='l', main="Original ditribution", xlab=NULL, ylab=NULL, xlim=c(0.5,1), ylim=c(0, max(max(kd.1$y * sd.SCORE), max(kd.2$y * sd.SCORE.1))))
lines(kd.2$x, kd.2$y * sd.SCORE.1, col='#67a9cf') #blue -> SCORE.1

# Original distributions - zscore

dev.set(dev.zscore)
plot(c(0,0), c(0,1), col='#ef8a62', type='l', main="Original ditribution - Z-Score", xlab=NULL, ylab=NULL, xlim=c(min.zscore, max.zscore), ylim=c(0, 1))
lines(c(0,0), c(0,1), col='#67a9cf')

x <- seq(0.5,1,0.0001)
# x.zscore <- seq(min.zscore,max.zscore,0.0001)

for (i in 1:nstates) {
	# base
	dev.set(dev.base)
	y.1 <- dnorm(x, mu[i,1], sigma[i,1]) * sigma[i,1]
	#y.1 <- y.1/sum(y.1)
	y.2 <- dnorm(x, mu[i,2], sigma[i,2]) * sigma[i,2]
	#y.2 <- y.2/sum(y.2)
	max.y <- max(y.1, y.2)

	plot(x, y.1, type='l', col='#ef8a62', xlim=c(0.5,1), ylim=c(0,max.y), main=paste("State ", as.character(i-1), collapse=NULL, sep=''))
	lines(x, y.2, type='l', col='#67a9cf')

	# zscore
	dev.set(dev.zscore)
	# y.1 <- dnorm(x.zscore, mu.zscore[i,1], sigma[i,1]) * sigma[i,2]
	#y.1 <- y.1/sum(y.1)
	# y.2 <- dnorm(x.zscore, mu.zscore[i,2], sigma[i,2]) * sigma[i,2]
	#y.2 <- y.2/sum(y.2)
	# max.y <- max(y.1, y.2)

	plot(c(mu.zscore[i,1], mu.zscore[i,1]), c(0,1), type='l', col='#ef8a62', xlim=c(min.zscore,max.zscore), ylim=c(0,1), main=paste("State ", as.character(i-1), collapse=NULL, sep=''))
	lines(c(mu.zscore[i,2], mu.zscore[i,2]), c(0,1), type='l', col='#67a9cf')
}

# compute probability
# t$P_STATE_0 <- dnorm(t$SCORE, mu[1,1], sigma[1,1]) * sigma[1,1] * dnorm(t$SCORE.1, mu[1,2], sigma[1,2]) * sigma[1,2]
# if(nstates > 1) t$P_STATE_1 <- dnorm(t$SCORE, mu[2,1], sigma[2,1]) * sigma[2,1] * dnorm(t$SCORE.1, mu[2,2], sigma[2,2]) * sigma[2,2]
# if(nstates > 2) t$P_STATE_2 <- dnorm(t$SCORE, mu[3,1], sigma[3,1]) * sigma[3,1] * dnorm(t$SCORE.1, mu[3,2], sigma[3,2]) * sigma[3,2]
# if(nstates > 3) t$P_STATE_3 <- dnorm(t$SCORE, mu[4,1], sigma[4,1]) * sigma[4,1] * dnorm(t$SCORE.1, mu[4,2], sigma[4,2]) * sigma[4,2]
#
# write.table(t, paste(args[1], ".out", collapse=NULL, sep=""), sep="\t", append=FALSE, quote=FALSE, eol="\n", row.names=FALSE, col.names=names(t))


dev.off(dev.base)
dev.off(dev.zscore)

colors <- brewer.pal(nstates, "Spectral")
png(paste(as.character(nstates), "_states.png", collapse=NULL, sep=""), width=7*600, height=7*600, res=600, pointsize=10)
plot(t$SCORE[t$STATE==0], t$SCORE.1[t$STATE==0], col=colors[1], xlim=c(0.5,1), ylim=c(0.5,1), main="Assigned states", xlab="Score 0", ylab="Score 1")
for (i in 2:nstates) {
	lines(t$SCORE[t$STATE==i-1], t$SCORE.1[t$STATE==i-1], col=colors[i], type='p')
}
# numbers <- paste("", sep="", collapse=NULL)
# for (i in 1:nstates) {
#	paste(numbers, "State ", sep="", collapse=NULL)
#	paste(numbers, as.character(i-1), sep="", collapse=NULL)
#	paste(numbers, ": ", sep="", collapse=NULL)
# 	paste(numbers, as.character(counts[i]), sep="", collapse=NULL)
# 	paste(numbers, "\n", sep="", collapse=NULL)
# }
# mtext(numbers, side = 4, cex=0.6)

dev.off()
